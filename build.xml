<!--
	Build file for photoservlet.

	Copyright (c) 2002	Dustin Sallings <dustin@spy.net>

	$Id: build.xml,v 1.11 2002/06/23 03:42:10 dustin Exp $
-->

<project name="PhotoServlet" default="photo.jar" basedir=".">

	<!-- Set up the class path -->
	<path id="photo.classpath">
		<fileset dir="photo/WEB-INF/lib">
			<include name="*.jar"/>
		</fileset>
		<fileset dir="${user.home}/lib/java">
			<include name="jsdk.jar"/>
			<include name="resin.jar"/>
			<include name="dom.jar"/>
			<include name="sax.jar"/>
			<include name="xerces.jar"/>
		</fileset>
	</path>

	<target name="clean">
		<delete>
			<fileset dir="net">
				<include name="**/*.class"/>
				<include name="spy/photo/sp/*.java"/>
			</fileset>
			<fileset dir=".">
				<include name="photo.jar"/>
				<include name="photo.war"/>
				<include name="photo.zip"/>
			</fileset>
		</delete>
		<delete dir="docs"/>
	</target>

	<target name="docs">
		<mkdir dir="docs"/>
		<javadoc destdir="docs"
			author="true"
			version="true"
			use="true"
			sourcepath="."
			packagenames="net.spy.*"
			classpathref="photo.classpath"
			windowtitle="PhotoServlet API Documentation"/>
	</target>

	<!-- This is specific to my development at home. -->
	<target name="install" depends="photo.jar">
		<copy file="photo.jar"
			tofile="/afs/.spy.net/misc/web/root/photo/WEB-INF/lib/photo.jar"/>
	</target>

	<target name="photo.jar" depends="all">
		<jar jarfile="photo.jar" basedir=".">
			<include name="**/*.class"/>
			<include name="net/**/*.properties"/>
		</jar>
	</target>

	<target name="photo.war" depends="photo.jar">
		<jar jarfile="photo.war" basedir="." excludes="**">
			<zipfileset dir="photo" prefix=""/>
			<zipfileset dir="." prefix="WEB-INF/lib" includes="photo.jar"/>
			<zipfileset dir="etc" prefix="WEB-INF" includes="photo.conf"/>
		</jar>
	</target>

	<target name="photo.zip" depends="photo.war,docs">
		<zip zipfile="photo.zip" basedir="." excludes="**">
			<zipfileset dir="." prefix="" includes="doc/**"/>
			<zipfileset dir="docs" prefix="doc/api" includes="**"/>
			<zipfileset dir="." prefix="" includes="etc/*"/>
			<zipfileset dir="." prefix="" includes="photo.war"/>
		</zip>
	</target>

	<target name="dist" depends="photo.zip"/>

	<target name="all" depends="rmic,spfiles">
		<javac srcdir="." destdir="." deprecation="on" depend="on" verbose="false">
			<classpath refid="photo.classpath"/>
			<include name="net/spy/photo/**/*.java"/>
			<include name="net/spy/rmi/**/*.java"/>
		</javac>
	</target>

	<target name="spfiles">
		<taskdef name="spgen" classname="net.spy.util.SPGenTask">
			<classpath refid="photo.classpath"/>
		</taskdef>
		<spgen srcdir="." destdir="."/>
	</target>

	<target name="rmic" depends="pre-rmic">
		<rmic base="." classname="net.spy.photo.rmi.RemoteImageServerImpl">
			<classpath refid="photo.classpath"/>
		</rmic>
	</target>

	<target name="pre-rmic" depends="spfiles">
		<javac srcdir="." destdir="." deprecation="on" depend="on" verbose="false">
			<classpath refid="photo.classpath"/>
			<include name="net/spy/photo/rmi/RemoteImageServerImpl.java"/>
		</javac>
	</target>

</project>
