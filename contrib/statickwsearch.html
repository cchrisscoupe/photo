<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
  Copyright (c) 2004  Dustin Sallings <dustin+html@spy.net>
  -->
<html>
	<head>
		<title>Testing</title>
	</head>

	<body>
		<script language="JavaScript" src="test.js"></script>
		<script language="JavaScript">
		var kws = new Array();

		// This assumes sorted arrays in order to be O(log n)
		function arrayContains(a, key) {
			var rv = false;
			var low = 0;
			var high = a.length - 1;
			while(rv == false && low <= high) {
				var middle = Math.floor((low + high) / 2);

				if(key == a[middle]) {
					rv = true;
				} else if(key < a[middle]) {
					high = middle - 1;
				} else {
					low = middle + 1;
				}
			}
			return rv;
		}

		// Get a union of all of the arrays passed in as arguments
		function arrayUnion(a) {
			var rv = null;
			if(a.length < 1) {
				alert("Too few arguments to arrayUnion");
			} else {
				rv = a[0];
				for(var i=1; i<a.length; i++) {
					var tmprv=new Array();
					for(var j=0; j<rv.length; j++) {
						if(arrayContains(a[i], rv[j])) {
							tmprv.push(rv[j]);
						}
					}
					rv=tmprv;
				}
			}
			return rv;
		}

		// This should perform some kind of and logic across selections
		function getImageIds() {
			var tmpa=new Array();
			for(var i = 0; i<kws.length; i++) {
				tmpa.push(imgs[kws[i]]);
			}
			return arrayUnion(tmpa);
		}
		function showResults() {
			var div=document.getElementById("found");
			var h="";
			// Maximum number of images to show
			var total = 50
			var tmpimgs=getImageIds();
			// h = tmpimgs.join(" ") + "<br>\n";
			for(var i=0; i<tmpimgs.length; i++) {
				var img=tmpimgs[i]
				if(total > 0) {
					h += '<a href="pages/' + photloc[img] + "/" + img + '.html">';
					h += '<img src="pages/' + photloc[img] + '/' + img + '_tn.jpg"/> ';
					h += '</a>';
				} else if(total == 0) {
					h += " ... ";
				}
				total -= 1
			}
			div.innerHTML = h;
		}
		function checkedKwBox(c, kwi) {
			// First, remove it from the kws
			var tmp = new Array()
			for(var i=0; i<kws.length; i++) {
				if(kws[i] != kwi) {
					tmp.push(kws[i]);
				}
			}
			kws=tmp;
			if(c.checked) {
				kws.push(kwi);
			}
			// this will get the shortest list first which makes unions faster
			kws.sort();
			kws.reverse();
			// Update the display
			showResults();
		}
		function initForm(f) {
			var h ="";
			var div = document.getElementById("keywordlist");
			for(var i=0; i<keywords.length; i++) {
				var k=keywords[i];
				h += '<input type="checkbox" name="keyword" value="' + k 
					+ ' " onclick="checkedKwBox(this, ' + i + ')" />' + k + "("
					+ imgs[i].length + ")  ";
			}
			div.innerHTML=h

		}
		onload = function() {
			initForm(document.bigform);
		}
		</script>

		Form:<br/>
		<form name="bigform" method="POST" action="">
			<div style="font-size: x-small" id="keywordlist"><span/></div>
			<input type="submit" value="Search"/>
		</form>
		Found:
		<div id="found"><span/></div>
	</body>
</html>
